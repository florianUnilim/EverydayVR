<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>A-frame everyday</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <!--<script>
    // Fade + switch visibilité entre 2 phases (dans la MÊME a-scene)
    AFRAME.registerComponent("scene-switch", {
      schema: {
        hide: { type: "selector" },  // phase à cacher
        show: { type: "selector" },  // phase à afficher
        fade: { type: "selector" },
        delay: { type: "number", default: 650 }
      },
      init() {
        this.el.addEventListener("switchscene", () => {
          const { hide, show, fade, delay } = this.data;
          if (!fade || !hide || !show) return;

          fade.setAttribute("visible", true);
          fade.emit("fadein");

          setTimeout(() => {
            hide.setAttribute("visible", false);
            show.setAttribute("visible", true);
            fade.emit("fadeout");
          }, delay);
        });
      }
    });

    // Zone + touche pour s'asseoir
    AFRAME.registerComponent("sit-zone", {
      schema: {
        rig: { type: "selector" },
        seat: { type: "selector" },
        switcher: { type: "selector" },
        sfx: { type: "selector" },
        key: { type: "string", default: "e" },
        ms: { type: "number", default: 900 },
        hint: { type: "selector" }
      },

      init() {
        this.inside = false;

        this._onKeyDown = (ev) => {
          if (!this.inside) return;
          if (ev.key.toLowerCase() !== this.data.key.toLowerCase()) return;
          this.sit();
        };
        window.addEventListener("keydown", this._onKeyDown);
      },

      remove() {
        window.removeEventListener("keydown", this._onKeyDown);
      },

      tick() {
        const rig = this.data.rig;
        if (!rig) return;

        const rigPos = new THREE.Vector3();
        const zonePos = new THREE.Vector3();
        rig.object3D.getWorldPosition(rigPos);
        this.el.object3D.getWorldPosition(zonePos);

        const g = this.el.getAttribute("geometry");
        const radius = g ? Math.max(g.width, g.depth) * 0.5 : 1.5;

        const nowInside = rigPos.distanceTo(zonePos) <= radius;

        if (nowInside !== this.inside) {
          this.inside = nowInside;
          if (this.data.hint) this.data.hint.setAttribute("visible", this.inside);
        }
      },

      sit() {
        const { rig, seat, sfx, switcher, ms } = this.data;
        if (!rig || !seat) return;

        if (sfx?.components?.sound) sfx.components.sound.playSound();

        const p = seat.getAttribute("position");
        rig.setAttribute("animation__sit", {
          property: "position",
          to: `${p.x} ${p.y} ${p.z}`,
          dur: ms,
          easing: "easeOutCubic"
        });

        setTimeout(() => {
          if (switcher) switcher.emit("switchscene");
        }, ms + 150);
      }
    });
  </script>-->
</head>

<body>
  <a-scene>

    <!-- ASSETS (une seule fois) -->
    <a-assets>
      <img id="fabricColor"  src="/EverydayVR/models/textures/Fabric019_1K-JPG_Color.jpg">
      <img id="fabricRough"  src="/EverydayVR/models/textures/Fabric019_1K-JPG_Roughness.jpg">
      <img id="fabricNormal" src="/EverydayVR/models/textures/Fabric019_1K-JPG_NormalGL.jpg">

      <img id="PaperColor" src="/EverydayVR/models/textures/Paper004_1K-JPG_Color.jpg">
      <img id="PaperRough" src="/EverydayVR/models/textures/Paper004_1K-JPG_Roughness.jpg">
      <img id="PaperNormal" src="/EverydayVR/models/textures/Paper004_1K-JPG_NormalGL.jpg">

      <img id="SnowColor" src="/EverydayVR/models/textures/Snow010A_1K-JPG_Color.jpg">
      <img id="SnowRough" src="/EverydayVR/models/textures/Snow010A_1K-JPG_Roughness.jpg">
      <img id="SnowNormal" src="/EverydayVR/models/textures/Snow010A_1K-JPG_NormalGL.jpg">

      <a-asset-item id="bancModel" src="/EverydayVR/models/banc-no-texture.glb"></a-asset-item>
       
      <img id="montagne-bg" src="/images/bg-montagne.png">
      <img id="montagne-2" src="/images/montagne-2.png">
      <img id="bg-left" src="/images/bg-leftside.png">


      <!-- Mets un vrai fichier audio sinon ça sert à rien -->
      <!-- <audio id="seatSfx" src="/EverydayVR/sounds/seat.mp3"></audio> -->
    </a-assets>

    <!-- RIG caméra (toujours visible) -->
    <a-entity id="rig" position="0 1.6 4">
      <a-camera>
        <!-- FADE: attaché à la caméra (très important) -->
        <a-plane
          id="fade"
          position="0 0 -0.6"
          width="4" height="4"
          visible="false"
          material="color:#000; transparent:true; opacity:0"
          animation__fadein="property: material.opacity; to: 1; dur: 450; easing: easeOutQuad; startEvents: fadein"
          animation__fadeout="property: material.opacity; to: 0; dur: 450; easing: easeOutQuad; startEvents: fadeout"
        ></a-plane>
      </a-camera>

      <!-- PC cursor -->
      <a-entity cursor="rayOrigin: mouse" raycaster="objects: .clickable"></a-entity>
    </a-entity>

    <!-- VR controllers -->
    <a-entity laser-controls="hand: left"  raycaster="objects: .clickable"></a-entity>
    <a-entity laser-controls="hand: right" raycaster="objects: .clickable"></a-entity>

    <!-- Lumières (toujours présentes) -->
    <a-entity light="type: ambient; intensity: 0.8"></a-entity>
    <a-entity light="type: directional; intensity: 0.8" position="1 2 1"></a-entity>

    <!-- ========= PHASE 1 ========= -->
    <a-entity id="phase1" visible="false">

      <!-- Son (optionnel : active seulement si tu mets un vrai audio dans assets) -->
      <!-- <a-entity id="seatSound" sound="src:#seatSfx; autoplay:false; volume:1"></a-entity> -->

      <a-plane
        color="#9C8B61"
        height="100"
        width="100"
        rotation="-90 0 0"
        material="
          shader: standard;
          src: #fabricColor;
          roughnessMap: #fabricRough;
          normalMap: #fabricNormal;
          metalness: 0;
          repeat: 100 100;
          normalScale: 1 1;
        ">
      </a-plane>

      <a-entity
        id="benchModel"
        gltf-model="#bancModel"
        position="-1.380 0 -1.500"
        scale="150 150 150">
      </a-entity>

      <!-- Hint -->
      <a-entity
        id="sitHint"
        position="-1.380 1.9 -1.500"
        text="value: Appuie sur E pour t'asseoir; color: #111; align: center; width: 4"
        visible="false">
      </a-entity>

      <!-- Zone d'assise -->
      <a-box
        id="sitZone"
        position="-1.380 1.0 -1.500"
        width="4"
        height="2"
        depth="4"
        material="opacity: 0; transparent: true"
        sit-zone="rig:#rig; seat:#seatPoint; switcher:#switcher; key:e; ms:900; hint:#sitHint">
      </a-box>

      <!-- Point d'assise -->
      <a-entity id="seatPoint" position="-1.380 1.15 -1.25"></a-entity>

      <!-- Switcher -->
      <a-entity
        id="switcher"
        scene-switch="hide:#phase1; show:#phase2; fade:#fade; delay:650">
      </a-entity>

      <a-sky color="#E6D3A3"></a-sky>
    </a-entity>

    <!-- ========= PHASE 2 ========= -->
    <a-entity id="phase2" visible="true">
      <!-- Mets ici ton décor 2 (sol, sky, objets, sons...) -->
      <a-sky color="#E6D3A3"></a-sky>


      <a-entity
        id="benchModel"
        gltf-model="#bancModel"
        position="-1.380 0 -1.500"
        scale="150 150 150">
      </a-entity>

     
      <a-plane
        color="#130A06"
        height="100"
        width="100"
        rotation="-90 0 0"
        material="
          shader: standard;
          src: #SnowColor;
          roughnessMap: #SnowRough;
          normalMap: #SnowNormal;
          metalness: 0;
          repeat: 100 100;
          normalScale: 1 1;
        ">

      </a-plane>

      <a-image
        src="#montagne-2"
        position="0 16.450 -51.368"
        rotation="0 0 0"
        scale="1 1 1"
        width="100"
        height="50">
      </a-image>
      
      <a-image
        src="#bg-left"
        position="-49.942 16.450 -1.698"
        rotation="0 90 0"
        scale="1 1 1"
        width="100"
        height="50">
      </a-image>
    </a-entity>

  </a-scene>
</body>
</html>
